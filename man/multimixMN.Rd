% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/multimixMN.R
\name{multimixMN}
\alias{multimixMN}
\title{Multilayer MGM with bootstrap, intra-/inter-layer metrics, and CIs}
\usage{
multimixMN(
  data,
  type,
  level,
  layers,
  layer_rules,
  scale = TRUE,
  reps = 100,
  lambdaSel = c("CV", "EBIC"),
  lambdaFolds = 5,
  lambdaGam = 0.25,
  exclude_from_graph = NULL,
  exclude_from_cluster = NULL,
  seed_model = NULL,
  seed_boot = NULL,
  treat_singletons_as_excluded = FALSE,
  cluster_method = c("louvain", "fast_greedy", "infomap", "walktrap", "edge_betweenness"),
  compute_community_scores = FALSE
)
}
\arguments{
\item{data}{A numeric matrix/data frame (n × p) with variables in columns.}

\item{type}{Length-\code{p} vector of variable types (as in \pkg{mgm}).}

\item{level}{Length-\code{p} vector of variable levels (as in \pkg{mgm}).}

\item{layers}{A named vector (names = variable names) assigning each node to a
layer (character or factor). Must cover all columns of \code{data}.}

\item{layer_rules}{A logical/numeric square matrix with row/column names equal
to layer names. \code{TRUE}/1 indicates \strong{cross-layer} edges are allowed
between the corresponding layer pair. The diagonal (intra-layer) is always
treated as allowed; if the diagonal is \code{NA}, it is coerced to allowed.}

\item{scale}{Logical; if TRUE (default) Gaussian variables (type == "g") are z-standardized internally by \code{mgm()}. Use \code{scale = FALSE} if your data are already standardized}

\item{reps}{Integer; number of bootstrap resamples (row resampling with replacement).
Default \code{100}.}

\item{lambdaSel}{Character; lambda selection for \pkg{mgm} (\code{"CV"} or \code{"EBIC"}).}

\item{lambdaFolds}{Integer; number of folds for CV (used when \code{lambdaSel = "CV"}).}

\item{lambdaGam}{Numeric; EBIC gamma (used when \code{lambdaSel = "EBIC"}).}

\item{exclude_from_graph}{Character vector; nodes to exclude from the \strong{graph}
(no edges, no centralities). They will not appear in per-layer graphs.}

\item{exclude_from_cluster}{Character vector; nodes excluded from \strong{clustering}
(no membership), but can still appear in the graph. Final set is
\code{union(exclude_from_cluster, exclude_from_graph)}.}

\item{seed_model}{Optional integer; seed for the initial MGM fit reproducibility.}

\item{seed_boot}{Optional integer; seed used inside \code{future.apply} for
bootstrap reproducibility.}

\item{treat_singletons_as_excluded}{Logical; if \code{TRUE}, singletons are
treated as excluded for community-dependent metrics/plots.}

\item{cluster_method}{Community detection algorithm. One of
\code{c("louvain","fast_greedy","infomap","walktrap","edge_betweenness")}.}

\item{compute_community_scores}{Logical; if TRUE, compute community network scores (EGAnet std.scores) with 95\% CIs and bootstrap array.}
}
\value{
An object of class \code{"multimixMN_fit"} with elements:
\describe{
\item{\code{layers}}{Named vector of layer assignment for all nodes.}
\item{\code{layer_rules}}{Normalized symmetric matrix of allowed cross-layer edges.}
\item{\code{layer_fits}}{Named list keyed by layer name. \strong{Each element is an
object of class \code{mixMN_fit}} (single-layer fit) containing its empirical
community structure, bootstrap matrices (\code{strength_boot}, \code{ei1_boot},
\code{closeness_boot}, \code{betweenness_boot}, \code{edge_boot_mat}),
bridge metrics (included & excluded) and their percentile CIs in \code{ci_results}.}
\item{\code{interlayer}}{List with interlayer-only node metrics:
\describe{
\item{\code{centrality_true}}{Data frame with per-node strength, EI1, closeness, betweenness (interlayer-only).}
\item{\code{ci_results}}{List of percentile CIs for those metrics.}
\item{\code{strength_boot}, \code{ei1_boot}, \code{closeness_boot}, \code{betweenness_boot}}{(reps × p) bootstrap matrices.}
\item{\code{edges}}{Named list per allowed layer pair with true cross-layer edges, bootstrap matrices, and CIs.}
}
}
\item{\code{exclude_from_graph}, \code{exclude_from_cluster}}{Echo of inputs.}
\item{\code{cluster_method}, \code{reps}, \code{seed_model}, \code{seed_boot}}{Echo of inputs.}
}
}
\description{
Estimates a \strong{multilayer} network using a masked Mixed Graphical Model (MGM).
The mask enforces which cross-layer edges are allowed according to \code{layer_rules}
(intra-layer edges are always allowed). For each layer, the function computes
community structure, nonparametric row-bootstrap for node centralities and
edge weights, and bridge metrics (including "excluded" nodes logic).
Optionally computes community network scores with CIs and bootstrap arrays. It also
returns \strong{interlayer-only} node metrics (strength, EI1, closeness, betweenness)
with bootstrap confidence intervals.
}
\details{
\itemize{
\item This function does \strong{not} call \code{future::plan()}. Set it beforehand to enable parallel bootstrap.
\item It calls \code{bridge_metrics()} and \code{bridge_metrics_excluded()} internally (provide them in your package).
\item Community scores use EGAnet \strong{std.scores} (z-standardized per community).
}

Internally, the function:
\enumerate{
\item Builds per-node masks so that each node may connect only to nodes in
its own layer and in layers permitted by \code{layer_rules}.
\item Fits a masked \pkg{mgm} model (\code{mgm_masked()}) to obtain signed
weighted adjacency (\code{wadj * signs}).
\item Splits nodes by layer and creates per-layer fits via \code{mixMN_from_wadj()},
which assigns communities and prepares containers for bootstrap outputs.
\item Runs \code{reps} bootstrap iterations (with \code{future.apply}) to
recompute centralities, edge weights, bridge metrics (via
\code{bridge_metrics()} and \code{bridge_metrics_excluded()}),
community assignments, interlayer-only metrics, and cross-layer edge weights.
\item Aggregates bootstrap matrices into per-layer and interlayer summaries,
returning point estimates and percentile CIs.
}
}
\section{Dependencies}{

Relies on internal helpers \code{mgm_masked()}, \code{mixMN_from_wadj()},
\code{bridge_metrics()}, and \code{bridge_metrics_excluded()}.
}

